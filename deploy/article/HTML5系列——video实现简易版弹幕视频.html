<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTML5系列——video实现简易版弹幕视频 | 大猿猴的前端世界</title>
    <meta name="generator" content="VuePress 1.8.3">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <meta name="description" content="欢迎来到我的前端世界">
    <meta name="theme-color" content="#1890ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.6abea489.css" as="style"><link rel="preload" href="/assets/js/app.6e6b01fe.js" as="script"><link rel="preload" href="/assets/js/2.dbfa9150.js" as="script"><link rel="preload" href="/assets/js/17.43adc959.js" as="script"><link rel="prefetch" href="/assets/js/10.2e16735c.js"><link rel="prefetch" href="/assets/js/11.b19e559e.js"><link rel="prefetch" href="/assets/js/12.982ef838.js"><link rel="prefetch" href="/assets/js/13.b6e14983.js"><link rel="prefetch" href="/assets/js/14.b5b8d8d0.js"><link rel="prefetch" href="/assets/js/15.704bf1c9.js"><link rel="prefetch" href="/assets/js/16.f32ca14f.js"><link rel="prefetch" href="/assets/js/18.14c29226.js"><link rel="prefetch" href="/assets/js/19.4834627a.js"><link rel="prefetch" href="/assets/js/20.e007027f.js"><link rel="prefetch" href="/assets/js/21.47165eb5.js"><link rel="prefetch" href="/assets/js/22.022c4ce2.js"><link rel="prefetch" href="/assets/js/23.7a28dc0a.js"><link rel="prefetch" href="/assets/js/24.7c3b9dd9.js"><link rel="prefetch" href="/assets/js/25.fa5ae975.js"><link rel="prefetch" href="/assets/js/26.f09de5de.js"><link rel="prefetch" href="/assets/js/27.b6249b07.js"><link rel="prefetch" href="/assets/js/28.fad674e0.js"><link rel="prefetch" href="/assets/js/3.b96152e9.js"><link rel="prefetch" href="/assets/js/4.488a9543.js"><link rel="prefetch" href="/assets/js/5.7bb7af0c.js"><link rel="prefetch" href="/assets/js/6.4b2eed0a.js"><link rel="prefetch" href="/assets/js/7.228baa7c.js"><link rel="prefetch" href="/assets/js/8.d9bb6b7a.js"><link rel="prefetch" href="/assets/js/9.79d8d830.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6abea489.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="大猿猴的前端世界" class="logo"> <span class="site-name can-hide">大猿猴的前端世界</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/article/" class="nav-link router-link-active">
  文章
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/" aria-current="page" class="sidebar-link">HTML5系列——语义</a></li><li><a href="/article/HTML5系列——存储上.html" class="sidebar-link">HTML5系列——存储(上)</a></li><li><a href="/article/HTML5系列——存储下.html" class="sidebar-link">HTML5系列——存储(下)</a></li><li><a href="/article/HTML5系列——video实现简易版弹幕视频.html" class="active sidebar-link">HTML5系列——video实现简易版弹幕视频</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/HTML5系列——video实现简易版弹幕视频.html#video标签属性" class="sidebar-link">video标签属性</a></li><li class="sidebar-sub-header"><a href="/article/HTML5系列——video实现简易版弹幕视频.html#source标签属性" class="sidebar-link">source标签属性</a></li><li class="sidebar-sub-header"><a href="/article/HTML5系列——video实现简易版弹幕视频.html#如何制作一个简易版弹幕视频" class="sidebar-link">如何制作一个简易版弹幕视频？</a></li></ul></li><li><a href="/article/HTML5系列——Canvas应用.html" class="sidebar-link">HTML5系列——Canvas应用</a></li><li><a href="/article/CSS系列——来次Sass与Less的碰撞.html" class="sidebar-link">CSS系列——来次Sass与Less的语法碰撞</a></li><li><a href="/article/CSS系列——CSS3动画实现3D倒计时.html" class="sidebar-link">CSS系列——CSS3动画实现3D倒计时</a></li><li><a href="/article/ES系列——Promise基础.html" class="sidebar-link">ES系列——Promise基础</a></li><li><a href="/article/ES系列——Generator函数与Async函数.html" class="sidebar-link">ES系列——Generator函数与Async函数</a></li><li><a href="/article/ES系列——模块化规范与ES6模块.html" class="sidebar-link">ES系列——模块化规范与ES6模块</a></li><li><a href="/article/Web技术系列——BOM基础.html" class="sidebar-link">Web技术系列——BOM基础</a></li><li><a href="/article/工具篇——markdown入门.html" class="sidebar-link">工具篇——markdown入门</a></li><li><a href="/article/工具篇——Hexo基础.html" class="sidebar-link">工具篇——Hexo基础</a></li><li><a href="/article/工具篇——使用Hexo在Github快速建站.html" class="sidebar-link">工具篇——使用Hexo在Github快速建站</a></li><li><a href="/article/工具篇——VuePress建站.html" class="sidebar-link">工具篇——VuePress建站</a></li><li><a href="/article/工具篇——VSCode如何一键生成模板.html" class="sidebar-link">工具篇——VSCode如何一键生成模板</a></li><li><a href="/article/工具篇——Postman如何作并发请求.html" class="sidebar-link">工具篇——Postman如何作并发请求</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="video实现简易版弹幕视频"><a href="#video实现简易版弹幕视频" class="header-anchor">#</a> video实现简易版弹幕视频</h1> <p>认识两个HTML5标签，分别是video和source。</p> <h2 id="video标签属性"><a href="#video标签属性" class="header-anchor">#</a> video标签属性</h2> <ul><li>autoplay：表示视频是否就绪后马上播放，值为autoplay</li> <li>controls：表示是否向用户显示控件，值为controls</li> <li>height：表示视频播放器高度</li> <li>width：表示视频播放器宽度</li> <li>loop：表示当媒介文件完成播放后是否再次开始播放，值为loop</li> <li>preload：表示视频是否在页面加载时进行加载，并预备播放，若使用autoplay，则忽略该属性，值为preload</li> <li>poster：指定视频加载时显示的图片url</li> <li>src：指定要播放的视频url</li></ul> <h2 id="source标签属性"><a href="#source标签属性" class="header-anchor">#</a> source标签属性</h2> <ul><li>src：指定要链接的媒介资源URL</li> <li>type：表示资源的MIME类型。比如在video标签中支持类型有video/mp4、video/ogg和video/webm</li></ul> <h2 id="如何制作一个简易版弹幕视频"><a href="#如何制作一个简易版弹幕视频" class="header-anchor">#</a> 如何制作一个简易版弹幕视频？</h2> <ul><li><p>HTML部分</p> <p>内容分为屏幕层和弹幕层，屏幕层由视频、输入框和按钮组成，比较简单。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--屏幕层--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--视频--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen-video<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">loop</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./video/happy.mp4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>video/mp4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        您的浏览器不支持 video 标签。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--输入框--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen-input<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--发送按钮--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>screen-button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--弹幕层--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>barrage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>CSS部分</p> <p>布局结合百分比布局和REM布局，使网页响应式，体验稍好。</p> <div class="language-CSS extra-class"><pre class="language-css"><code><span class="token selector">.screen-video</span> <span class="token punctuation">{</span>    
    <span class="token property">width</span><span class="token punctuation">:</span>80%<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 1rem 10%<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid white<span class="token punctuation">;</span> 
    
    <span class="token comment">/*填充父元素，IE和Edge不支持,真头疼！！！*/</span>
    <span class="token property">object-fit</span><span class="token punctuation">:</span> fill<span class="token punctuation">;</span>      
<span class="token punctuation">}</span>

<span class="token selector">.screen-input</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span>10%<span class="token punctuation">;</span>

    <span class="token property">height</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span>

    <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.screen-button</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 10%<span class="token punctuation">;</span>

    <span class="token property">height</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span>

    <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span>
    <span class="token property">letter-spacing</span><span class="token punctuation">:</span> 0.2em<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 0.8rem<span class="token punctuation">;</span>

    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.barrage</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span>10%<span class="token punctuation">;</span>

    <span class="token property">width</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>
    
    <span class="token comment">/*x轴方向上超过则隐藏内容*/</span>
    <span class="token property">overflow-x</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    
    <span class="token property">z-index</span><span class="token punctuation">:</span> 999<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>JavaScript部分</p> <p>第一步，设置事件监听</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//窗口加载时初始化</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span>init<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//窗口大小变化时重新初始化</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span>init<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输入框回车时发送弹幕文字</span>
content<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> e <span class="token operator">=</span> event<span class="token operator">||</span>window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>which <span class="token operator">==</span> <span class="token string">&quot;13&quot;</span><span class="token operator">||</span> e<span class="token punctuation">.</span>keyCode <span class="token operator">==</span><span class="token string">&quot;13&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第二步，事件处理</p> <ul><li><p>初始化</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">// 实现REM布局需要根据窗口大小来控制根字体大小</span>
    <span class="token comment">// 浏览器默认字体大小是16px，最小字体是12px</span>
    html<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        html<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token string">&quot;12px&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//设置video的高度</span>
    video<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span>  <span class="token function">parseInt</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetWidth<span class="token operator">/</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//设置input的宽度</span>
    content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> btn_send<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//设置button的位置</span>
    btn_send<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetHeight <span class="token operator">+</span> video<span class="token punctuation">.</span>offsetTop <span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//设置barrage的位置和高度</span>
    barrage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span>video<span class="token punctuation">.</span>offsetTop <span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
    barrage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> video<span class="token punctuation">.</span>offsetHeight <span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>以前通过获取样式对象进行初始化，如下，</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> sstyle <span class="token operator">=</span> screen<span class="token punctuation">.</span>currentStyle<span class="token operator">||</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> vstyle <span class="token operator">=</span> video<span class="token punctuation">.</span>currentStyle<span class="token operator">||</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>之后放弃使用这种方式，一是有兼容性，比如获取margin，在Chrome和FF正常，但是到了IE和FF则不支持了，获取marginTop、marginLeft等则正常，虽然可以解决，但是为了这点问题，折腾半天，实在没必要。二是JS需要关注CSS是否应用了该样式，如果没有，那么获取的是默认值，比如margin默认值是auto，但是我想获取具体的数值，这就不好处理了。总之，涉及BOM操作的还是少用比较好。</p></li> <li><p>发送弹幕内容</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//发送内容</span>
    <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建的节点</span>
    <span class="token keyword">var</span> span<span class="token punctuation">;</span>
    <span class="token comment">//偏移量</span>
    <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//帧ID</span>
    <span class="token keyword">var</span> id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建节点</span>
        span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置文本</span>
        span<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> val<span class="token punctuation">;</span>
        <span class="token comment">//设置样式</span>
        span<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;barrage-span&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//添加</span>
        barrage<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置初始位置，注意添加元素后宽度和高度才生效。</span>
        span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetHeight<span class="token operator">-</span>span<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span>  video<span class="token punctuation">.</span>offsetWidth<span class="token operator">+</span><span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置监听事件</span>
        span<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mouseover&quot;</span><span class="token punctuation">,</span> stop<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        span<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mouseout&quot;</span><span class="token punctuation">,</span> scroll<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//默认初始文本滚动</span>
        <span class="token function">scroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    content<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">function</span> <span class="token function">scroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        offset <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>

        span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&quot;translateX(-&quot;</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">&quot;px)&quot;</span><span class="token punctuation">;</span>
        span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&quot;transform 0s linear&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&gt;=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetWidth<span class="token operator">+</span>span<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            barrage<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    
            id <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>scroll<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//去除两边空格</span>
    <span class="token keyword">function</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(^\s*)|(\s*$)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//指定范围内获取随机数</span>
    <span class="token keyword">function</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取任意颜色</span>
    <span class="token keyword">function</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token string">&quot;#&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> j<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            j <span class="token operator">=</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color <span class="token operator">+=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在处理发送弹幕时，发现文字不时会超出弹幕层，从而出现滚动条，结果发现是下面这句代码出现了问题，</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token function">getRandomNumber</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>offsetHeight<span class="token operator">-</span>span<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>span.offsetHeight打印结果总为0，后来把这句代码放在父元素添加span元素之后，即下面这句代码就可以了。这说明了要使元素的offsetWidth、offsetHeight等属性值生效，需要注意元素是否已经渲染到浏览器上，单单创建一个元素对象，但是没有添加到文档中，只是存放在内存，还没有被浏览器渲染。先记录下来，避免以后填坑，哈哈。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>barrage<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h4 id="附上源码"><a href="#附上源码" class="header-anchor">#</a> 附上源码：</h4> <p><a href="https://github.com/muzhidong/frontend-demo/tree/master/barrage-video" target="_blank" rel="noopener noreferrer">https://github.com/muzhidong/frontend-demo/tree/master/barrage-video<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/HTML5系列——存储下.html" class="prev">
        HTML5系列——存储(下)
      </a></span> <span class="next"><a href="/article/HTML5系列——Canvas应用.html">
        HTML5系列——Canvas应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6e6b01fe.js" defer></script><script src="/assets/js/2.dbfa9150.js" defer></script><script src="/assets/js/17.43adc959.js" defer></script>
  </body>
</html>
